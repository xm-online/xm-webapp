<div class="text-right">
  <button (click)="onAddEntitySpec()"
          [matTooltip]="('admin-config.specification-mng.editor.add-entity-spec' | translate)"
          color="primary"
          mat-icon-button
          [disabled]="disabled">
    <mat-icon>add</mat-icon>
  </button>
  <button (click)="onApplyChanges()"
          [matTooltip]="('admin-config.specification-mng.editor.apply-changes' | translate)"
          color="primary"
          mat-icon-button
          [disabled]="disabled">
    <mat-icon>save_alt</mat-icon>
  </button>
</div>

<mat-accordion class="headers-align">
  <mat-expansion-panel (opened)="openedEntitySpec = index"
                       *ngFor="let entitySpec of spec?.types; let index = index"
                       [disabled]="disabled">
    <mat-expansion-panel-header>
      <mat-panel-title>
        {{entitySpec.name | translate}}
      </mat-panel-title>
      <mat-panel-description>
        <span *ngIf="!entitySpec.isAbstract">{{entitySpec.key}}</span>
        <span *ngIf="entitySpec.isAbstract"><i>{{entitySpec.key}}</i></span>

        <mat-icon>{{entitySpec.icon}}</mat-icon>

      </mat-panel-description>
    </mat-expansion-panel-header>

    <div *ngIf="openedEntitySpec === index">
      <mat-form-field>
        <input matInput
               type="text"
               [placeholder]="('admin-config.specification-mng.editor.key' | translate)"
               [(ngModel)]="entitySpec.key">
      </mat-form-field>

      <xm-multi-language-control
        [value]="toMultiLanguageDataModel(entitySpec.name)"
        [options]="{title: ('admin-config.specification-mng.editor.name' | translate)}"
        (onValueChange)="fromMultiLanguageDataModel(entitySpec.name, $event)"
      ></xm-multi-language-control>

      <xm-multi-language-control
        [value]="toMultiLanguageDataModel(entitySpec.pluralName)"
        [options]="{title: ('admin-config.specification-mng.editor.plural-name' | translate)}"
        (onValueChange)="fromMultiLanguageDataModel(entitySpec.pluralName, $event)"
      ></xm-multi-language-control>

      <div class="row">
        <div class="col-4">
          <mat-checkbox [(ngModel)]="entitySpec.isAbstract" color="primary">
            {{'admin-config.specification-mng.editor.is-abstract' | translate}}
          </mat-checkbox>
        </div>
        <div class="col-4">
          <mat-checkbox [(ngModel)]="entitySpec.isApp" color="primary">
            {{'admin-config.specification-mng.editor.is-application' | translate}}
          </mat-checkbox>
        </div>
        <div class="col-4">
          <mat-form-field>
            <mat-select [placeholder]="('admin-config.specification-mng.editor.icon' | translate)"
                        [(ngModel)]="entitySpec.icon">
              <mat-select-trigger>
                {{entitySpec.icon}}
              </mat-select-trigger>
              <mat-option *ngFor="let icon of icons" [value]="icon">
                <mat-icon>{{icon}}</mat-icon>{{icon}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <mat-label>{{'admin-config.specification-mng.editor.data-spec' | translate}}</mat-label>
      <div class="text-right">
        <div [mode]="'json'"
             [options]="{ highlightActiveLine: true, maxLines: 25 }"
             [style.width]="'100%'"
             [text]="entitySpec.dataSpec"
             (textChanged)="onDataSpecChanged(entitySpec, $event)"
             xmAceEditor>
        </div>
      </div>

      <mat-label>{{'admin-config.specification-mng.editor.form-spec' | translate}}</mat-label>
      <div class="text-right">
        <div [mode]="'json'"
             [options]="{ highlightActiveLine: true, maxLines: 25 }"
             [style.width]="'100%'"
             [text]="entitySpec.dataForm"
             (textChanged)="onDataFormChanged(entitySpec, $event)"
             xmAceEditor>
        </div>
      </div>

      <xm-states-editor
        [entitySpec]="entitySpec"
      ></xm-states-editor>

      <mat-divider></mat-divider>
      <div class="d-flex pt-2">
        <div class="p-2">
          <h3>{{'admin-config.specification-mng.editor.links' | translate}}</h3>
        </div>
      </div>
      <p>{{'admin-config.specification-mng.editor.coming-soon' | translate}}</p>

      <mat-divider></mat-divider>
      <div class="d-flex pt-2">
        <div class="p-2">
          <h3>{{'admin-config.specification-mng.editor.functions' | translate}}</h3>
        </div>
      </div>
      <p>{{'admin-config.specification-mng.editor.coming-soon' | translate}}</p>

      <mat-divider></mat-divider>
      <div class="d-flex pt-2">
        <div class="p-2">
          <h3>{{'admin-config.specification-mng.editor.attachments' | translate}}</h3>
        </div>
      </div>
      <p>{{'admin-config.specification-mng.editor.coming-soon' | translate}}</p>

      <mat-divider></mat-divider>
      <div class="d-flex pt-2">
        <div class="p-2">
          <h3>{{'admin-config.specification-mng.editor.comments' | translate}}</h3>
        </div>
      </div>
      <p>{{'admin-config.specification-mng.editor.coming-soon' | translate}}</p>

      <mat-divider></mat-divider>
      <div class="d-flex pt-2">
        <div class="p-2">
          <h3>{{'admin-config.specification-mng.editor.locations' | translate}}</h3>
        </div>
      </div>
      <p>{{'admin-config.specification-mng.editor.coming-soon' | translate}}</p>
    </div>

    <mat-action-row>
      <button mat-button color="primary"
              (click)="onDeleteEntitySpec(entitySpec)">
        {{'admin-config.specification-mng.editor.delete' | translate}}
      </button>
    </mat-action-row>

  </mat-expansion-panel>
</mat-accordion>
