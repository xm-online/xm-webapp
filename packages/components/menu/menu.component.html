<div class="menu-view"
     [ngClass]="{'old-menu': categories?.length === 1}"
     *ngIf="subCategories$ | async"
     (mouseleave)="hideMenuRightSide($event)">
  <cdk-tree [dataSource]="filteredCategories"
            [treeControl]="treeControl"
            [@showHideSubCategories]="{value: showSubCategoriesState}"
            (@showHideSubCategories.done)="onHideSubCategoriesDone()"
  >
    <cdk-tree-node *cdkTreeNodeDef="let node">
      <a class="menu-link"
         *permitted="node.permission"
         [routerLink]="node.url"
         [ngClass]="{'active': node.isActiveRoute}"
         (click)="setSelectedCategory(node)"
      >
      <span class="xm-menu-item-text" [title]="node?.title | translate">
        {{node?.title | translate}}
      </span>
      </a>
    </cdk-tree-node>

    <cdk-nested-tree-node *cdkTreeNodeDef="let node; when: hasChild">
      <a class="menu-link"
         *permitted="node.permission"
         (click)="toggleOrNavigate(node, $event)"
         [ngClass]="{
            'active-menu-category': node === parentCategory,
            'active': !node.children?.length && node?.category === selectedCategory
         }"
      >
        <mat-icon class="menu-icon" *ngIf="categories.length === 1">{{node.icon}}</mat-icon>
        <span class="xm-menu-item-text">{{node?.title | translate}}</span>
        <span class="ms-auto"></span>

        <mat-icon
          *ngIf="node.children?.length"
          class="menu-link-icon"
          (click)="toggle(node, $event)"
          [@indicatorRotate]="isNodeExpanded(node)">
          arrow_drop_down
        </mat-icon>
      </a>

      <div class="menu-list nested-menu-list" role="group" [@bodyExpansion]="isNodeExpanded(node)">
        <ng-container cdkTreeNodeOutlet></ng-container>
      </div>
    </cdk-nested-tree-node>
  </cdk-tree>
</div>
